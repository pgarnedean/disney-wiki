<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Wiki</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- 1. Disney Wiki ãƒ†ãƒ¼ãƒè¨­å®š --- */
        :root {
            --disney-blue: #1e366e; /* ã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©åŸã®ã‚ˆã†ãªæ·±ã„é’ */
            --disney-gold: #c5a059; /* é­”æ³•ã®ç²‰ã®ã‚ˆã†ãªã‚´ãƒ¼ãƒ«ãƒ‰ */
            --bg-color: #fcfcfc;
            --text-color: #222;
            --link-color: #0645ad; /* Wikipediaã®é’ */
            --wiki-border: #a7d7f9;
        }

        body {
            font-family: 'Noto Serif JP', serif; /* Wikipediaã‚‰ã—ã„æ˜æœä½“ãƒ™ãƒ¼ã‚¹ */
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            line-height: 1.6;
        }

        /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
        header {
            background: linear-gradient(135deg, var(--disney-blue), #0d1b38);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border-bottom: 3px solid var(--disney-gold);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            font-weight: bold;
            color: var(--disney-gold);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .logo::before {
            content: 'âœ¨';
            margin-right: 10px;
            font-size: 20px;
        }

        .user-panel {
            font-family: sans-serif;
            font-size: 14px;
        }

        .btn {
            background-color: var(--disney-gold);
            color: var(--disney-blue);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn:hover {
            background-color: white;
            box-shadow: 0 0 10px var(--disney-gold);
        }

        /* --- ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (è–æ¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ) --- */
        .container {
            display: flex;
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            min-height: 80vh;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            border-radius: 4px;
            position: relative;
        }

        /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ (ç›®æ¬¡) */
        .sidebar-left {
            width: 250px;
            padding: 20px;
            background: #fbfbfb;
            border-right: 1px solid #eee;
            font-size: 14px;
        }
        
        .toc-container {
            position: sticky;
            top: 80px;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
        }

        .toc-title {
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
            margin-bottom: 10px;
            padding-bottom: 5px;
        }

        .toc-list a {
            display: block;
            color: var(--link-color);
            text-decoration: none;
            margin-bottom: 5px;
            padding-left: 10px;
        }
        
        .toc-list a:hover {
            text-decoration: underline;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .main-content {
            flex: 1;
            padding: 30px 40px;
            position: relative;
        }

        /* å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ (Infobox) */
        .infobox-container {
            float: right;
            width: 300px;
            margin: 0 0 20px 20px;
            background: #fff;
            border: 1px solid #aaa;
            padding: 5px;
            font-size: 90%;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }

        .infobox-title {
            background: var(--disney-blue);
            color: white;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-family: 'Cinzel', serif;
            border: 2px solid var(--disney-gold);
        }

        .infobox-image img {
            width: 100%;
            height: auto;
            display: block;
            margin: 10px 0;
        }

        .infobox-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .infobox-table th, .infobox-table td {
            border-bottom: 1px solid #ddd;
            padding: 5px;
            text-align: left;
        }

        /* --- è¨˜äº‹ã‚¹ã‚¿ã‚¤ãƒ« --- */
        h1.page-title {
            font-family: 'Cinzel', serif;
            border-bottom: 2px solid var(--disney-gold);
            padding-bottom: 10px;
            font-size: 2.5em;
            margin-top: 0;
        }

        h2 {
            border-bottom: 1px solid #aaa;
            padding-bottom: 5px;
            margin-top: 30px;
            font-family: 'Cinzel', serif;
            color: var(--disney-blue);
        }

        .content-text {
            margin-bottom: 15px;
        }

        a.wiki-link {
            color: var(--link-color);
            text-decoration: none;
        }
        a.wiki-link:hover { text-decoration: underline; }
        
        /* åŸ‹ã‚è¾¼ã¿è¦ç´  */
        .wiki-image, .wiki-video {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
            padding: 3px;
            background: #fff;
            margin: 10px 0;
        }

        .wiki-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .wiki-table th, .wiki-table td {
            border: 1px solid #ccc;
            padding: 8px;
        }
        .wiki-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        /* --- ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ UI --- */
        .edit-controls {
            display: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéè¡¨ç¤º */
            background: #fff8e1;
            padding: 20px;
            border: 2px dashed var(--disney-gold);
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .edit-active .edit-controls {
            display: block;
        }

        .edit-active .view-only {
            display: none;
        }

        .input-group {
            margin-bottom: 15px;
        }
        
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        textarea { height: 100px; }

        .editor-section {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .add-btn {
            background: #eee;
            border: 1px dashed #999;
            width: 100%;
            padding: 10px;
            cursor: pointer;
            margin-top: 10px;
        }
        .add-btn:hover { background: #e0e0e0; }

        /* ãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
        #setup-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 8px; max-width: 500px;
            text-align: center; border: 4px solid var(--disney-gold);
        }

    </style>
</head>
<body>

    <header>
        <div class="logo" onclick="app.router('home')">Disney Wiki</div>
        <div class="user-panel">
            <span id="user-name" style="margin-right:15px; display:none;">ã‚²ã‚¹ãƒˆ</span>
            <button id="auth-btn" class="btn">Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>
    </header>

    <div class="container">
        <div class="sidebar-left">
            <div class="toc-container" id="toc-area">
                <div class="toc-title">ç›®æ¬¡</div>
                <div class="toc-list" id="toc-list">
                    <span style="color:#999; font-style:italic;">è¨˜äº‹ã®å†…å®¹ã‹ã‚‰ç”Ÿæˆã•ã‚Œã¾ã™</span>
                </div>
            </div>
            <div style="margin-top: 30px; text-align: center;">
                <button class="btn" onclick="app.createNewPage()" style="font-size:12px;">ï¼‹ æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹</button>
            </div>
        </div>

        <main class="main-content" id="main-content">
            
            <div id="view-mode" class="view-only">
                <div id="infobox-placeholder"></div>
                <h1 class="page-title" id="view-title">Welcome to Disney Wiki</h1>
                <div id="view-body">
                    <p>ã“ã“ã«ã¯ã¾ã ä½•ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚å³ä¸Šã®ç·¨é›†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é­”æ³•ã‚’ã‹ã‘ã¦ãã ã•ã„ï¼</p>
                </div>
                <div style="margin-top: 50px; border-top: 1px solid #eee; padding-top: 10px; text-align: right;">
                    <button class="btn" id="edit-btn" onclick="app.toggleEdit()">ã“ã®ãƒšãƒ¼ã‚¸ã‚’ç·¨é›† âœ</button>
                </div>
            </div>

            <div id="edit-mode" class="edit-controls">
                <h2>ğŸ“ ãƒšãƒ¼ã‚¸ã‚’ç·¨é›†</h2>
                
                <div class="input-group">
                    <label>ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="edit-title-input">
                </div>

                <div style="background:#f0f8ff; padding:10px; margin-bottom:15px; border:1px solid #add8e6;">
                    <h3>Infobox (å³å´ã®æƒ…å ±æ )</h3>
                    <div class="input-group">
                        <label>ç”»åƒã®URL</label>
                        <input type="text" id="edit-info-image" placeholder="https://...">
                    </div>
                    <div id="edit-info-rows">
                        </div>
                    <button type="button" onclick="editor.addInfoRow()">ï¼‹ æƒ…å ±è¡Œã‚’è¿½åŠ </button>
                </div>

                <hr>

                <div id="edit-sections">
                    </div>

                <button class="add-btn" onclick="editor.addSection()">ï¼‹ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè¦‹å‡ºã—ãƒ»æœ¬æ–‡ï¼‰ã‚’è¿½åŠ </button>
                
                <div style="margin-top: 30px; text-align: right;">
                    <button class="btn" style="background:#ccc;" onclick="app.toggleEdit()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button class="btn" onclick="app.savePage()">âœ¨ ä¿å­˜ã—ã¦å…¬é–‹</button>
                </div>
            </div>

        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // ============================================================
        // è¨­å®šå…¥åŠ›æ¸ˆã¿
        // ============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyBXGAvYQnGZGIALlfsE93C4vBMR41Lp6QA",
            authDomain: "disney-wiki-b76e8.firebaseapp.com",
            projectId: "disney-wiki-b76e8",
            storageBucket: "disney-wiki-b76e8.firebasestorage.app",
            messagingSenderId: "929516211078",
            appId: "1:929516211078:web:a9c5b3a32a9a9c089e3a07"
        };
        // ============================================================

        // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
        const firebaseApp = initializeApp(firebaseConfig);
        const auth = getAuth(firebaseApp);
        const db = getFirestore(firebaseApp);
        const provider = new GoogleAuthProvider();

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ç®¡ç†
        window.app = {
            currentPageId: 'home',
            currentUser: null,
            data: {}, // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿

            // åˆæœŸåŒ–
            init: function() {
                // URLãƒãƒƒã‚·ãƒ¥ãŒå¤‰ã‚ã£ãŸã‚‰ãƒšãƒ¼ã‚¸ç§»å‹•
                window.addEventListener('hashchange', () => this.router());
                
                // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
                onAuthStateChanged(auth, (user) => {
                    this.currentUser = user;
                    this.updateAuthUI();
                });

                // åˆå›ãƒ­ãƒ¼ãƒ‰
                this.router();
            },

            // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
            router: function(pageId) {
                if(pageId) window.location.hash = pageId;
                const hash = window.location.hash.replace('#', '') || 'home';
                this.currentPageId = hash;
                this.loadPage(hash);
                window.scrollTo(0,0);
            },

            // èªè¨¼UIæ›´æ–°
            updateAuthUI: function() {
                const btn = document.getElementById('auth-btn');
                const nameSpan = document.getElementById('user-name');
                if (this.currentUser) {
                    btn.textContent = 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ';
                    btn.onclick = () => signOut(auth);
                    nameSpan.textContent = this.currentUser.displayName;
                    nameSpan.style.display = 'inline';
                    document.getElementById('edit-btn').style.display = 'inline-block';
                } else {
                    btn.textContent = 'Googleã§ãƒ­ã‚°ã‚¤ãƒ³';
                    btn.onclick = () => signInWithPopup(auth, provider);
                    nameSpan.style.display = 'none';
                    // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ç·¨é›†ãƒœã‚¿ãƒ³ã‚’éš ã™ï¼ˆã¾ãŸã¯æŠ¼ã—ãŸã¨ãã«ãƒ­ã‚°ã‚¤ãƒ³ã‚’ä¿ƒã™ï¼‰
                    document.getElementById('edit-btn').style.display = 'none';
                }
            },

            // Firestoreã‹ã‚‰ãƒšãƒ¼ã‚¸å–å¾—
            loadPage: async function(id) {
                // UIãƒªã‚»ãƒƒãƒˆ
                document.getElementById('edit-mode').classList.remove('edit-active');
                document.getElementById('view-mode').classList.remove('edit-active');
                document.getElementById('view-mode').style.display = 'block';
                document.getElementById('edit-mode').style.display = 'none';

                try {
                    const docRef = doc(db, "pages", id);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        this.data = docSnap.data();
                        this.renderView(this.data);
                    } else {
                        // æ–°è¦ãƒšãƒ¼ã‚¸ã®å ´åˆ
                        this.data = {
                            title: id === 'home' ? 'Disney Wiki Home' : decodeURIComponent(id),
                            sections: [],
                            infobox: { image: '', rows: [] }
                        };
                        this.renderView(this.data);
                        if(id !== 'home') {
                            // æ–°è¦ãƒšãƒ¼ã‚¸ã®ã¿ç¢ºèª
                            if(confirm('ã“ã®ãƒšãƒ¼ã‚¸ã¯ã¾ã å­˜åœ¨ã—ã¾ã›ã‚“ã€‚ä½œæˆã—ã¾ã™ã‹ï¼Ÿ')) {
                                this.toggleEdit();
                            }
                        }
                    }
                } catch (e) {
                    console.error("Error loading page:", e);
                    if(e.code === 'permission-denied') {
                        alert('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§Firestoreã®ãƒ«ãƒ¼ãƒ«ã‚’ã€Œãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã€ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                    } else if (e.code === 'unavailable') {
                        alert('ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                    }
                }
            },

            // é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
            renderView: function(data) {
                document.getElementById('view-title').textContent = data.title;
                const viewBody = document.getElementById('view-body');
                const tocList = document.getElementById('toc-list');
                const infoboxPlaceholder = document.getElementById('infobox-placeholder');

                viewBody.innerHTML = '';
                tocList.innerHTML = '';
                infoboxPlaceholder.innerHTML = '';

                // Infoboxç”Ÿæˆ
                if (data.infobox && (data.infobox.image || (data.infobox.rows && data.infobox.rows.length > 0))) {
                    let infoHtml = `<div class="infobox-container">
                        <div class="infobox-title">${data.title}</div>`;
                    
                    if(data.infobox.image) {
                        infoHtml += `<div class="infobox-image"><img src="${data.infobox.image}" alt="Image"></div>`;
                    }
                    
                    if(data.infobox.rows && data.infobox.rows.length > 0) {
                        infoHtml += `<table class="infobox-table"><tbody>`;
                        data.infobox.rows.forEach(row => {
                            infoHtml += `<tr><th>${row.key}</th><td>${row.value}</td></tr>`;
                        });
                        infoHtml += `</tbody></table>`;
                    }
                    infoHtml += `</div>`;
                    infoboxPlaceholder.innerHTML = infoHtml;
                }

                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ¬æ–‡ï¼‰ç”Ÿæˆ
                if(!data.sections || data.sections.length === 0) {
                    viewBody.innerHTML = '<p>ã¾ã å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                } else {
                    data.sections.forEach((sec, index) => {
                        // è¦‹å‡ºã—
                        if(sec.heading) {
                            const h2 = document.createElement('h2');
                            h2.id = `section-${index}`;
                            h2.textContent = sec.heading;
                            viewBody.appendChild(h2);

                            // ç›®æ¬¡ã«è¿½åŠ 
                            const tocLink = document.createElement('a');
                            tocLink.href = `#section-${index}`;
                            // ãƒšãƒ¼ã‚¸å†…ãƒªãƒ³ã‚¯å‹•ä½œã®ä¸Šæ›¸ã
                            tocLink.onclick = (e) => {
                                e.preventDefault();
                                document.getElementById(`section-${index}`).scrollIntoView({behavior: 'smooth'});
                            };
                            tocLink.textContent = sec.heading;
                            tocList.appendChild(tocLink);
                        }

                        // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ–ãƒ­ãƒƒã‚¯ã®æç”»
                        const contentDiv = document.createElement('div');
                        contentDiv.className = 'content-text';
                        
                        // ãƒªãƒ³ã‚¯ã¨å¤ªå­—ã®ãƒ‘ãƒ¼ã‚¹å‡¦ç†
                        let html = sec.content || '';
                        // ãƒªãƒ³ã‚¯: [[ãƒšãƒ¼ã‚¸å]] -> <a href="#ãƒšãƒ¼ã‚¸å">ãƒšãƒ¼ã‚¸å</a>
                        html = html.replace(/\[\[(.*?)\]\]/g, '<a href="#$1" class="wiki-link" onclick="app.router(\'$1\')">$1</a>');
                        // å¤ªå­—: **æ–‡å­—** -> <b>æ–‡å­—</b>
                        html = html.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
                        // æ”¹è¡Œ
                        html = html.replace(/\n/g, '<br>');

                        contentDiv.innerHTML = html;
                        viewBody.appendChild(contentDiv);

                        // ãƒ¡ãƒ‡ã‚£ã‚¢æŒ¿å…¥ (ç”»åƒ/å‹•ç”»/è¡¨)
                        if(sec.mediaType === 'image' && sec.mediaUrl) {
                            viewBody.innerHTML += `<img src="${sec.mediaUrl}" class="wiki-image">`;
                        } else if(sec.mediaType === 'video' && sec.mediaUrl) {
                            viewBody.innerHTML += `<video src="${sec.mediaUrl}" controls class="wiki-video"></video>`;
                        } else if(sec.mediaType === 'table' && sec.tableData) {
                            // ç°¡æ˜“çš„ãªè¡¨è¡¨ç¤º
                            let tableHtml = '<table class="wiki-table"><tbody>';
                            sec.tableData.forEach(row => {
                                tableHtml += '<tr>';
                                row.forEach(cell => {
                                    tableHtml += `<td>${cell}</td>`;
                                });
                                tableHtml += '</tr>';
                            });
                            tableHtml += '</tbody></table>';
                            viewBody.innerHTML += tableHtml;
                        }
                    });
                }
            },

            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã¸ã®åˆ‡ã‚Šæ›¿ãˆ
            toggleEdit: function() {
                if(!this.currentUser) {
                    alert('ç·¨é›†ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');
                    signInWithPopup(auth, provider);
                    return;
                }
                const view = document.getElementById('view-mode');
                const edit = document.getElementById('edit-mode');
                
                if (edit.style.display === 'none') {
                    // ç·¨é›†é–‹å§‹ï¼šãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥ã‚Œã‚‹
                    view.style.display = 'none';
                    edit.style.display = 'block';
                    editor.loadEditor(this.data);
                } else {
                    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    view.style.display = 'block';
                    edit.style.display = 'none';
                }
            },

            // ä¿å­˜å‡¦ç†
            savePage: async function() {
                const newData = editor.getData();
                try {
                    await setDoc(doc(db, "pages", this.currentPageId), newData);
                    alert('ä¿å­˜ã—ã¾ã—ãŸï¼âœ¨');
                    this.data = newData;
                    this.loadPage(this.currentPageId); // ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦è¡¨ç¤º
                } catch (e) {
                    console.error(e);
                    alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
                }
            },

            // æ–°è¦ãƒšãƒ¼ã‚¸ä½œæˆ
            createNewPage: function() {
                const name = prompt("æ–°ã—ã„ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šãƒŸãƒƒã‚­ãƒ¼ãƒã‚¦ã‚¹ï¼‰");
                if(name) {
                    this.router(name);
                }
            }
        };

        // ã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½ (DOMæ“ä½œ)
        window.editor = {
            loadEditor: function(data) {
                document.getElementById('edit-title-input').value = data.title || '';
                
                // Infobox
                document.getElementById('edit-info-image').value = (data.infobox && data.infobox.image) ? data.infobox.image : '';
                document.getElementById('edit-info-rows').innerHTML = '';
                if(data.infobox && data.infobox.rows) {
                    data.infobox.rows.forEach(r => this.addInfoRow(r.key, r.value));
                }

                // Sections
                document.getElementById('edit-sections').innerHTML = '';
                if(data.sections) {
                    data.sections.forEach(s => this.addSection(s));
                } else {
                    this.addSection(); // ç©ºã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’1ã¤è¿½åŠ 
                }
            },

            addInfoRow: function(key='', val='') {
                const div = document.createElement('div');
                div.className = 'input-group';
                div.style.display = 'flex';
                div.innerHTML = `
                    <input type="text" placeholder="é …ç›®å" value="${key}" class="info-key" style="width:30%; margin-right:5px;">
                    <input type="text" placeholder="å†…å®¹" value="${val}" class="info-val" style="width:60%;">
                    <button onclick="this.parentElement.remove()" style="width:10%;">Ã—</button>
                `;
                document.getElementById('edit-info-rows').appendChild(div);
            },

            addSection: function(data = null) {
                const container = document.getElementById('edit-sections');
                const div = document.createElement('div');
                div.className = 'editor-section';
                
                const heading = data ? data.heading : '';
                const content = data ? data.content : '';
                const mediaType = data ? data.mediaType : 'none';
                const mediaUrl = data ? data.mediaUrl : '';

                div.innerHTML = `
                    <label>è¦‹å‡ºã— (Heading)</label>
                    <input type="text" class="sec-heading" value="${heading}" placeholder="ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é¡Œå">
                    
                    <label style="margin-top:10px;">æœ¬æ–‡</label>
                    <small>â€» [[ãƒšãƒ¼ã‚¸å]] ã§ãƒªãƒ³ã‚¯ã€ **æ–‡å­—** ã§å¤ªå­—ã«ãªã‚Šã¾ã™</small>
                    <textarea class="sec-content" placeholder="èª¬æ˜æ–‡ã‚’å…¥åŠ›...">${content}</textarea>
                    
                    <label style="margin-top:10px;">æŒ¿å…¥ãƒ¡ãƒ‡ã‚£ã‚¢</label>
                    <select class="sec-media-type" onchange="this.nextElementSibling.style.display = (this.value === 'none' || this.value === 'table') ? 'none' : 'block';">
                        <option value="none" ${mediaType==='none'?'selected':''}>ãªã—</option>
                        <option value="image" ${mediaType==='image'?'selected':''}>ç”»åƒ (URL)</option>
                        <option value="video" ${mediaType==='video'?'selected':''}>å‹•ç”» (URL)</option>
                        </select>
                    <input type="text" class="sec-media-url" value="${mediaUrl}" placeholder="ç”»åƒã‚„å‹•ç”»ã®URL" style="display:${(mediaType==='none'||mediaType==='table')?'none':'block'}; margin-top:5px;">
                    
                    <button onclick="this.parentElement.remove()" style="margin-top:10px; background:#ffcccc; border:none; padding:5px;">ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤</button>
                `;
                container.appendChild(div);
            },

            getData: function() {
                // ã‚¿ã‚¤ãƒˆãƒ«
                const title = document.getElementById('edit-title-input').value;
                
                // Infobox
                const infoImg = document.getElementById('edit-info-image').value;
                const infoRows = [];
                document.querySelectorAll('#edit-info-rows .input-group').forEach(row => {
                    const k = row.querySelector('.info-key').value;
                    const v = row.querySelector('.info-val').value;
                    if(k) infoRows.push({key: k, value: v});
                });

                // Sections
                const sections = [];
                document.querySelectorAll('.editor-section').forEach(sec => {
                    sections.push({
                        heading: sec.querySelector('.sec-heading').value,
                        content: sec.querySelector('.sec-content').value,
                        mediaType: sec.querySelector('.sec-media-type').value,
                        mediaUrl: sec.querySelector('.sec-media-url').value,
                        tableData: [] 
                    });
                });

                return {
                    title: title,
                    infobox: { image: infoImg, rows: infoRows },
                    sections: sections
                };
            }
        };

        // ã‚¢ãƒ—ãƒªèµ·å‹•
        app.init();
    </script>
</body>
</html>